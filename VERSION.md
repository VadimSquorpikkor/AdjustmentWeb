# AdjustmentWeb   

* <b>1.47 - 11/02/22</b>
1. Глобальная переделка ч.6. Переделан весь код JS для страницы "Отслеживание". Окончание переделки, весь старый JS удален
* <b>1.46 - 11/02/22</b>
1. Глобальная переделка ч.5. Переделан весь код JS для страницы "Добавить". Из страницы удален код для таблицы nameId
* <b>1.45 - 10/02/22</b>
1. Глобальная переделка ч.4. Переделан весь код JS для страницы QR
* <b>1.44 - 10/02/22</b>
1. Глобальная переделка ч.3. Переделан весь код JS для страницы поиска
* <b>1.44 - 10/02/22</b>
1. Глобальная переделка ч.2. Начало переделки страницы поиска
* <b>1.44 - 10/02/22</b>
1. Глобальная переделка ч.1
* <b>1.44 - 09/02/22</b>
1. По-мелочи 
2. Подготовка к глобальной переделке. Цель: 1) перейти на новый вариант БД (без таблицы names, без поля id и name_id) 2) Перейти на хранение employees, devices, dev_set, states, locations в коде JS, а не качать данные каждый раз из БД (из БД только units и events), таким образом сократить количество запросов в БД; плюс упростить код
* <b>1.44 - 14/01/22</b>
1. Для эксперимента добавил библиотеку (fdictionary), в которой храню names, locations, devices. При загрузке страницы эти данные теперь берутся не из БД, а из этой библиотеки, это сделано, чтобы сократить кол-во запросов в БД. Из минусов: теперь если добавлю/поменяю имена, локации или устройства в БД, то придется их также менять в fdictionary (раньше ничего не нужно было менять, всё автоматом).
2. Перенес код для БД в один файл (firebase_low_level) (за исключением insert_page_biz.js)
* <b>1.43 - 14/01/22</b>
1. Исправления ошибок в js, корректировка css
* <b>1.42 - 13/01/22</b>
1. Для страницы отслеживания (location.html): отображается краткая инфа, при клике по div с инфой div раскрывается показывая подробную инфу
2. Поле ввода пароля сделано как пароль
3. Для страницы ввода данных в БД: добавлять/удалять данные теперь может только пользователь-администратор. При авторизации не администратора выводится соответствующее сообщение
* <b>1.41 - 13/01/22</b>
1. Для locations.html сделан перевод (было: показывались идентификаторы вместо имен)
2. Упорядочено отображение ссылок
* <b>1.40 - 12/01/22</b>
1. Авторизация. Сделан вход по email+паролю для каждой страницы. Войти может только зарегистрированный администратором пользователь. Все страницы сайта не работают без успешной авторизации
2. Переделана генерация QR-кода: убрано поле ввода ключа, если пользователь вошел в систему, то ключ берется из БД и подставляется при генерации, т.е. вводить ключ больше не нужно. Если ключ не удалось загрузить, на странице выводится сообщение об ошибке, сам код не генерируется  
* <b>1.39 - 11/01/22</b>
1. Начал делать страницу отображения нахождения устройств: 5 плиток (по кол-ву локаций) в каждой отображается список устройств которые находятся в данный момент в текущей локацией с подробной информацией об устройстве (тип, номер, ответственный и др). При перемещении реального устройства на другую локацию происходит немедленное изменение списков и отображаемых данных БЕЗ перезагрузки страницы (сервис отслеживает изменения в локациях)
2. Начал делать авторизацию. Пока всё плохо
* <b>1.38 - 01/10/21</b>
1. Исправлена загрузка списка устройств для страницы QR-кода и страницы ввода параметров
2. Добавлено отображение trackId в найденных устройствах (только в ремонтных)
3. Переделана надпись "ЗАВЕРШЕН" (раньше сливалась с остальными данными)
* <b>1.37 - 29/09/21</b>
1. Исправлены причины дооолгой загрузки данных из БД: был ошибочная реализация listen_new метода (внутри цикла получения данных ещё цикл получения данных, вместо 10 раз данные загружались 10 раз по 10 (100)); вместо join теперь библиотека.
2. Новый алгоритм получения данных и перевода id->name: при загрузке страницы первым делом загружаются данные из таблицы имен (только русский вариант). Эти данные помещаются в Map (dictionary), где ключ — это имя документа firebase, а значение — это значение поля "ru". При загрузке данных для employees, states, devices, location вместо join (как было раньше) используется метод changeNameIdToNameRu, который из библиотеки берет значение на русском по идентификатору
* <b>1.36 - 13/09/21</b>
1. Исправлены ошибки загрузки результатов поиска, когда у устройства нет никакого статуса (добавлено  if (typeof id === 'undefined'))
* <b>1.35 - 10/09/21</b>
1. В insert добавлены поля и методы для загрузки новых устройств в БД. Заполняет все поля в таблице устройств и дополнительно прописывает в таблицу имен русский и английский вариант написания 
* <b>1.34 - 22/07/21</b> (Версия не обновлялась)
1. Добавились картинки для БД  
* <b>1.34 - 12/07/21</b>
1. Исправлена ошибка поиска устройства по фамилии ответственного (ничего не находилось)    
* <b>1.33 - 06/07/21</b>
1. Переделан js для спиннера в QR генераторе. Код на SpinnerAdapter. В спиннере отображаются русские имена, на картинке QR-кода — русское название, при этом генерация qr-кода происходит на основе идентификатора (отображается "БДКГ-01", сохраняется, как "BDKG-01")  
* <b>1.32 - 06/07/21</b>
1. Добавлено отображение фамилии ответственного
2. Добавлено отображение типа устройства: "Ремонт" или "Серия"
3. Добавлен отступ между данными устройства и списком его статусов 
* <b>1.31 - 06/07/21</b>
1. Добавлено: если ремонт окончен (юнит закрыт), то вверху панельки устройства отображается соответствующая надпись  
* <b>1.30 - 06/07/21</b>
1. Исправления
2. Добавлена форма для удаления юнита по его id и всех его событий
* <b>1.29 - 24/06/21</b>
1. Починил qr-генератор — не работал
* <b>1.28 - 18/06/21</b>
1. Теперь содержимое спиннеров динамически изменяется, в зависимости от выбора в других спиннерах и радио: если выбрать локацию "Участок РИР", то в спиннере статусов будут отображаться только статусы для этой локации, и только те, которые соответствуют выбранному типу (серия или ремонт); при выборе "Серия" в локациях не будет отображаться "Группа Сервиса"
2. Раньше при каждом изменении в спиннерах данные каждый раз подгружались из БД (по выборке на основе показаний в спиннерах), сейчас вся логика работает на основе данных, загруженных при старте, новые данные загружаются только при нажатии "Найти"
3. Если написать номер в поле серийного номера, все спиннеры станут неактивными. Сделано, чтобы не путать пользователя: уже набрав номер, он может пытаться выбрать параметры в спиннерах, которые всё равно будут проигнорированы при поиске, так как при выбранном номере поиск будет идти ТОЛЬКО по серийному номеру
* <b>1.27 - 18/06/21</b>
1. Изменения в БД: удалены поля вариантов переводов имен из states, location, employees, devices. Теперь все переводы в "names"
2. Добавлен класс SpinnerAdapter для удобства работы со спинерами, код стал короче и понятнее. Добавление "любого значения" отвязано от массивов объектов, а добавляется в SpinnerAdapter
* <b>1.26 - 17/06/21</b>
1. Удалены неиспользуемые методы, удален dictionary.js, firebaseHelper.js, listeners.js, repair.html, добавлена ссылка на AtomtexRepair  
* <b>1.25 - 17/06/21</b> Глобальное обновление
1. Глобальное обновление. Так как в БД добавилась таблица имен (имя+варианты перевода на разных языках), то переделана вся логика приложения с тем, чтобы данные для названий (локаций, статусов и т.д.) брать из этой новой таблицы, а не как раньше, из полей в каждой таблице (которые будут удалены). Вся загвоздка была в отсутствии JOIN в firestore (это НЕ реляционная БД), поэтому было придумано некоторое подобие (по-сути дозагрузка по id c апдейтом), теперь в приложение грузится сразу массив объектов и с именем и идентификатором
2. В продолжении новой архитектуры: удалены переводчики: словари и getNameById/getIdByName
3. JOIN не используется при загрузке юнитов и событий, данные просто берутся из массивов объектов, загруженных для спиннеров
4. Добавлен entities.js и bis_logic.js. Удален listeners.js
5. Из index.html удалены все onClick и onChange, теперь всё сделано через onEventListener в bis_logic.js. Логика в bis_logic.js теперь основана на const, а не на id
6. Переделаны лисенеры, отслеживающие изменения в БД
* <b>1.24 - 11/06/21</b> (версия не меняется)
1. Начал переделывать логику перевода (идентификаторы -> имена, и обратно). Теперь лисенер отслеживает таблицу имен и при событиях загружает в Map идентификатор+имя. Во второй Map: имя+идентификатор (для обратного перевода). Когда то же самое будет доделано для AdjustmentDB, БД станет ещё ближе к нормальной форме, во всех таблицах будут убраны имена, остануться только идентификаторы
* <b>1.24 - 17/05/21</b>
1. Изменения в БД: теперь вместо одного русского языка для названий (name) добавлены 4 языка: Русский, Английский, Китайский, Итальянский, соответственно изменен код загружающий имена (name -> name_ru).
2. На странице загрузки (insert.html) добавлены поля для 4-х языков. Исправлено: раньше в случае загрузки не полного списка параметров для таблицы, проигнорированные параметры удалялись из таблицы (т.е. при сохранении по id сохранялись параметры, переданные в методе сохранения, если в таблице по этому id были ещё какие-то параметры, то они удалялись из таблицы). Теперь параметры добавляются (merge: true) (см. firebase_low_level) 
* <b>1.23 - 30/04/21</b>
1. Добавлено: при клике на элементе списка найденных устройств раскрывается список событий этого устройства. При повторном клике — список исчезает  
* <b>1.22 - 29/04/21</b>
1. Исправлено: При загрузке страницы в спинере статусов отображались все возможные статусы, теперь -- только статусы выбранного типа (серия/ремонт)   
* <b>1.21 - 29/04/21</b>
1. Переписаны лисенеры. Сокращение кода
2. Слово "день" в элементе списка теперь выводится в нужном падеже, в зависимости от количества дней
* <b>1.20 - 29/04/21</b>
1. Переделан внешний вид фильтра: теперь красиво в виде плитки
2. Если список найденных не отображается, то на месте списка отображается логотип (по аналогии с Android приложением AdjustmentDB)
3. Исправлена ошибка перевода списков имен устройств
* <b>1.19 - 29/04/21</b>
1. Перерисовал элемент списка найденных элементов: теперь список не в виде таблицы, каждый элемент отдельной плиткой. Отображается для каждого элемента: название устройства, серийный и внутренний номер, локация, дата/время последнего события, статус, количество дней в последней локации    
* <b>1.18 - 28/04/21</b>
1. Глобально переписан JS. Лисенеры теперь загружают пары списков -- список для имен и список для идентификаторов. На странице будут выводиться имена, в БД будут передаваться идентификаторы
2. Перерисована главная страница: теперь здесь сделан глобальный поиск устройств по БД, размещен фильтр для поиска. Поиск по: типу (серия/ремонт), по имени устройства, по локации, по статусу, по фамилии ответственного
3. Если в параметре поиска написать серийный номер, то поиск будет везтись ТОЛЬКО по серийному номеру, все другие параметры будут игнорироваться
4. Содержимое спиннера для статусов зависит от выбранного типа (серия/ремонт) и от выбранной локации, если выбрать "Все локации", то будут отображаться все существующие статусы
5. Все списки загружаются лисенерами, а значит любое изменение в соответствующей коллекции в БД немедленно приведет к обновлению соответствующего списка и спиннера без перезагрузки страницы
6. Реализован переводчик из id в имя и из имени в id (для списков данных)
7. В списке найденных устройств теперь все данные показываются правильно (раньше вместо названия указывался его идентификатор)
* <b>1.17 - 21/04/21</b>
1. Теперь на сгенерированном коде в самом изображении отображается тип устройства и его номер
2. Добавлено для ввода номера кнопки "+" "-" (увеличивать / уменьшать номер)
3. Только для Chrome: сгенерированное изображение автоматом помещается в буфер обмена
* <b>1.16 - 31/03/21</b>
1. Переделано под обновленную базу данных (см. коммит AdjustmentDB 1.28 - 08/04/21, база глобально менялась).
2. Добавлена иконка
3. Добавлен фильтр для ремонтных
4. Для ремонтных и серийных: если ничего не найдено, вместо таблицы будет отображаться "Не найдено"
* <b>1.15 - 31/03/21</b>
1. Добавлена страница для загрузки новых данных в БД. JS код закомментирован для безопасности, буду раскомментировать при необходимости и пока не сделаю аутентификацию 
* <b>1.14 - 31/03/21</b>
1. В класс статусов и класс юнитов добавлены поля location и description
2. Таблица серийных расширена на "Локация", "Описание"
2. Таблица ремонтов расширена на "Статус", "Локация", "Описание"
* <b>1.13 - 31/03/21</b>
1. Добавлены профили — монтаж, сборка, регулировка, приемка, градуировка.
2. Вместо вложенных в каждый unit списков статусов теперь для ВСЕХ статусов используется ОДНА коллекция
3. Глобально была переделана БД, следовательно, были переделаны многие методы  
4. Добавил форму для загрузки данных в БД — надоело вводить вручную (load2()) 
* <b>1.12 - 19/03/21</b>
1. Добавлено: вывод статусов текущего устройства теперь в хронологическом порядке  
* <b>1.11 - 18/03/21</b>
1. Изменения в названиях таблиц (навел порядок) — и в AdjustmentWeb, и в FireStore 
2. Теперь при поиске прибора (в ремонтных) в таблице статусов выводится и статусы и время добавления статуса (дата и время)
3. Исправлены мелкие ошибки
* <b>1.10 - 16/03/21</b>
1. Рефакторинг. Продолжение   
* <b>1.09 - 16/03/21</b>
1. Глобальный рефакторинг. Методы переделаны. Все (почти) что напрямую работают с БД перенесены в firebase_low_level.js, все лисенеры перенесены в listeners.js
2. На главной странице спиннеры теперь работают — фильтрация по статусам и по именам. Добавлены соответствующие методы 
* <b>1.08 - 10/03/21</b>
1. Для страницы ремонтных приборов реализовано отображение результата поиска прибора в БД по его типу и серийнику (фронтенд)
2. В базе данных, в таблице для ремонтных добавлена коллекция для хранения списка статусов и их даты добавления (т.е. коллекция в коллекции)
3. Добавлены методы для чтения данных коллекции в коллекции
4. Закомментированы лишние импорты Firebase 
5. Теперь при нахождении ремонтного прибора в базе, выводится таблица его статусов с датами
* <b>1.07 - 05/03/21</b>
1. Добавлена страница для ремонтных приборов
2. Добавлены методы для работы с таблицей БД для ремонтных приборов
3. Реализован поиск по БД для ремонтных по их серийному номеру и имени
* <b>1.06 - 05/03/21</b>
1. Список выбора типа устройства для страницы qr-кода теперь заполняется динамически из БД. При изменении в БД автоматом заполняется обновленными данными. По сути: теперь имя  устройства жестко связано со значением в БД, ситуация, когда можно ввести вручную неправильный (или несуществующий) тип устройства ИСКЛЮЧЕНА  
* <b>1.05 - 05/03/21</b>
1. Добавлена страница для генерации QR-кода: тип устройства выбирается из выпадающего спиннера (пока статический, потом будет динамически подгружаться данными из БД) и вводится внутренний серийник. Строка для qr-кода шифруется. Для безопасности добавлено поле ввода ключа для шифрования, без него полученный qr-код будет некорректным и не будет распознаваться в приложении для телефона. Потом для получения графического ключа будет отдельное приложение, пока так — из странички.
* <b>1.04 - 03/03/21</b>
1. Добавлен динамически связанный с БД спиннер для имен устройств. При изменении/добавлении имен в БД (отдельная таблица имен) данные в спиннере автоматически обновляются  
2. Добавлен динамически связанный с БД спиннер для названий статусов. При изменении/добавлении статусов в БД (отдельная таблица статусов) данные в спиннере автоматически обновляются
* <b>1.03 - 03/03/21</b>
1. Добавлен лисенер изменений в БД. При изменении/добавлении данных в БД данные на странице автоматически обновляются БЕЗ ПЕРЕЗАГРУЗКИ страницы
2. Данные отображаются в виде таблицы (динамически добавляется из JS: addDataRowToPage(unit[]))
3. Добавлен CSS
4. Добавлен ReadMe.md и Version.md
5. Веб страница — https://adjustmentdb.web.app/ 
* <b>1.02 - 02/03/21</b>
1. Добавлен класс DUnit и конвертер для работы с Firebase
2. Добавлен метод загрузки всех документов DUnit с Firestore. Работает и загружает данные в \<a>\</a>
* <b>1.01 - 02/03/21</b>
1. Настроена работа с БД, настроен хостинг. 
2. Теперь при нажатии на кнопку в БД добавляется запись (временно, для проверки)
* <b>1.00 - 01/03/21</b>
1. Initial Commit
